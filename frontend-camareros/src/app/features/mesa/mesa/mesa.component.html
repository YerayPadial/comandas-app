<div class="min-h-screen bg-gray-50 p-4 flex flex-col items-center">

    <h2
        class="text-4xl md:text-5xl font-black tracking-tight mb-8 text-blue-900 drop-shadow text-center w-full select-none">
        <span class="inline-flex items-center gap-2">Mesa: {{ nombreMesa }}</span>
    </h2>
    <!-- Categorías -->
    <div class="w-full flex flex-wrap justify-center gap-4 mb-8">
        <button *ngFor="let cat of categorias" (click)="categoriaSeleccionada = cat"
            class="min-w-[140px] py-4 px-4 rounded-2xl font-bold text-lg shadow-lg border-2 focus:outline-none flex items-center gap-2 transition-all duration-150"
            [ngClass]="categoriaSeleccionada === cat
        ? 'bg-blue-900 text-white border-blue-900 scale-105 ring-2 ring-blue-200'
        : 'bg-white text-gray-800 border-gray-200 hover:bg-blue-50 hover:scale-105'">
            <svg *ngIf="categoriaSeleccionada === cat" class="w-5 h-5 mr-1 text-white" fill="none" stroke="currentColor"
                stroke-width="3" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
            {{ cat }}
        </button>
    </div>

    <!-- Productos -->
    <div *ngIf="loading()" class="text-center py-8 text-gray-500 w-full">Cargando productos...</div>

    <div *ngIf="!loading() && productosFiltrados.length === 0" class="text-center py-8 text-gray-500 w-full">
        No hay productos disponibles en esta categoría.
    </div>
    
    <div *ngIf="!loading()" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 w-full
                pb-44 md:pb-8">
        <button *ngFor="let prod of productosFiltrados" (click)="agregarProducto(prod)"
            class="w-full py-4 px-2 rounded-xl font-bold text-base bg-white shadow hover:bg-blue-100 transition-all flex flex-col items-center border-2 border-gray-200 relative"
            style="position: relative;">
            <!-- Botón restar -->
            <span *ngIf="comandaActual[prod.id]" (click)="restarProducto(prod, $event)"
                class="absolute top-2 left-2 bg-red-600 text-white p-1 rounded-full shadow cursor-pointer select-none z-10 flex items-center justify-center"
                title="Quitar uno">
                <!-- Heroicons Minus Small SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12h12" />
                </svg>
            </span>

            <span>{{ prod.nombre }}</span>
            <span class="text-blue-900 text-lg mt-2 font-bold">{{ prod.precio | currency:'EUR' }}</span>
            <!-- Cantidad -->
            <span *ngIf="comandaActual[prod.id]"
                class="absolute top-2 right-2 bg-blue-900 text-white px-2 py-1 rounded-full shadow font-bold text-xs flex items-center justify-center z-10">
                x{{ comandaActual[prod.id].cantidad }}
            </span>
        </button>
    </div>

    <!-- Botones ver y salir -->
    <button (click)="verComanda()" [disabled]="!tieneComanda"
        class="fixed bottom-20 right-4 left-4 md:left-auto md:right-8 bg-blue-900 text-white px-6 py-3 md:px-8 md:py-4 rounded-full font-bold shadow-lg hover:bg-blue-700 transition-all text-base md:text-lg disabled:opacity-50"
        style="z-index:50">
        Ver Comanda
    </button>
    <button (click)="salir()"
        class="fixed bottom-4 right-4 left-4 md:left-auto md:right-8 bg-gray-500 text-white px-6 py-3 md:px-8 md:py-4 rounded-full font-bold shadow-lg hover:bg-gray-500 transition-all text-base md:text-lg"
        style="z-index:49">
        <svg class="inline-block w-7 h-7 mr-2 -mt-1 align-middle" fill="none" stroke="currentColor" stroke-width="3"
            viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h4a2 2 0 012 2v1" />
        </svg> Salir
    </button>
</div>